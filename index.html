<!DOCTYPE html>
<html>
<head>
  <title>Scientific Calculator</title>
  <style>
    /* styles.css */
    /* Moving styles to a separate file would be even better, keeping here for single-file demo */
    :root {
      --primary-bg: #282828;
      --display-bg: #3c3c3c;
      --btn-default: #444444;
      --btn-operator: #007bff;
      --btn-equals: #28a745;
      --btn-clear: #dc3545;
      --btn-memory: #6c757d;
      --btn-function: #17a2b8;
    }

    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }

    .calculator {
      background-color: var(--primary-bg);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 350px;
      width: 100%;
    }

    .display {
      background-color: var(--display-bg);
      color: #fff;
      padding: 15px;
      font-size: 24px;
      text-align: right;
      margin-bottom: 15px;
      border-radius: 5px;
      min-height: 30px;
      word-wrap: break-word;
      position: relative;
    }

    .previous-operation {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 14px;
      color: #888;
    }

    .current-value {
      margin-top: 15px;
    }

    .mode-indicators {
      display: flex;
      justify-content: space-between;
      color: #888;
      font-size: 12px;
      margin-bottom: 5px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-gap: 8px;
    }

    button {
      background-color: var(--btn-default);
      color: #fff;
      border: none;
      padding: 12px 8px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 45px;
    }

    .secondary-function {
      font-size: 12px;
      color: #888;
      margin-bottom: 2px;
    }

    button:active { transform: scale(0.95); }
    button:hover { filter: brightness(1.1); }
    button.operator { background-color: var(--btn-operator); }
    button.equals { background-color: var(--btn-equals); }
    button.clear, button.second { background-color: var(--btn-clear); }
    button.memory { background-color: var(--btn-memory); }
    button.function { background-color: var(--btn-function); }
    button.active { border: 2px solid #fff; }

    @media (max-width: 400px) {
      .calculator { width: 95%; margin: 10px; }
      button { padding: 8px 4px; font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="mode-indicators">
      <span id="second-indicator">2ND: OFF</span>
      <span id="memory-indicator">MEM: 0</span>
    </div>
    <div class="display">
      <div class="previous-operation" id="previous-operation"></div>
      <div class="current-value" id="display">0</div>
    </div>
    <div class="buttons" id="calculator-buttons"></div>
  </div>

  <script>
    // calculator-state.js
    const CalculatorState = {
      currentValue: '0',
      previousValue: null,
      operation: null,
      newNumberStarted: false,
      secondMode: false,
      memory: 0,
      variables: {},

      reset() {
        this.currentValue = '0';
        this.previousValue = null;
        this.operation = null;
        this.newNumberStarted = false;
      }
    };

    // calculator-display.js
    const Display = {
      updateMain(value = CalculatorState.currentValue) {
        document.getElementById('display').textContent = value;
      },

      updatePrevious(showEquals = false) {
        const previousOpDisplay = document.getElementById('previous-operation');
        const { previousValue, operation, currentValue } = CalculatorState;
        
        if (previousValue !== null && operation !== null) {
          const operator = this.formatOperator(operation);
          previousOpDisplay.textContent = `${previousValue} ${operator} ${showEquals ? currentValue : ''}`;
        } else {
          previousOpDisplay.textContent = '';
        }
      },

      formatOperator(op) {
        const operators = {
          '*': '×',
          '/': '÷',
          '-': '−',
          '^': '^',
        };
        return operators[op] || op;
      },

      updateMemoryIndicator() {
        document.getElementById('memory-indicator').textContent = `MEM: ${CalculatorState.memory}`;
      },

      updateSecondMode() {
        document.getElementById('second-indicator').textContent = `2ND: ${CalculatorState.secondMode ? 'ON' : 'OFF'}`;
      }
    };

    // calculator-operations.js
    const Operations = {
      basic: {
        '+': (a, b) => a + b,
        '-': (a, b) => a - b,
        '*': (a, b) => a * b,
        '/': (a, b) => b !== 0 ? a / b : null,
        '^': (a, b) => Math.pow(a, b)
      },

      scientific: {
        square: x => Math.pow(x, 2),
        cube: x => Math.pow(x, 3),
        sqrt: x => Math.sqrt(x),
        cubeRoot: x => Math.cbrt(x),
        inverse: x => x !== 0 ? 1 / x : null,
        percent: x => x / 100
      },

      memory: {
        MR: () => {
          CalculatorState.currentValue = CalculatorState.memory.toString();
          Display.updateMain();
        },
        MS: () => {
          CalculatorState.memory = parseFloat(CalculatorState.currentValue);
          Display.updateMemoryIndicator();
        },
        'M+': () => {
          CalculatorState.memory += parseFloat(CalculatorState.currentValue);
          Display.updateMemoryIndicator();
        },
        MC: () => {
          CalculatorState.memory = 0;
          Display.updateMemoryIndicator();
        }
      }
    };

    // calculator-handlers.js
    const Handlers = {
      handleNumber(value) {
        const state = CalculatorState;
        
        if (value === '.' && state.currentValue.includes('.')) return;
        
        if (state.newNumberStarted || state.currentValue === '0') {
          state.currentValue = value === '.' ? '0.' : value;
          state.newNumberStarted = false;
        } else {
          state.currentValue += value;
        }
        Display.updateMain();
      },

      handleOperator(op) {
        const state = CalculatorState;
        
        if (state.previousValue !== null && !state.newNumberStarted) {
          this.calculate();
        }
        state.operation = op;
        state.previousValue = parseFloat(state.currentValue);
        state.newNumberStarted = true;
        Display.updatePrevious();
      },

      handleEquals() {
        const state = CalculatorState;
        
        if (state.previousValue !== null && state.operation !== null) {
          Display.updatePrevious(true);
          this.calculate();
          state.operation = null;
          state.previousValue = null;
          state.newNumberStarted = true;
        }
      },

      calculate() {
        const state = CalculatorState;
        const current = parseFloat(state.currentValue);
        const operation = Operations.basic[state.operation];
        
        if (operation) {
          const result = operation(state.previousValue, current);
          if (result === null) {
            state.currentValue = 'Error: Division by zero';
          } else {
            // Format result to avoid floating point issues
            state.currentValue = parseFloat(result.toFixed(10))
              .toString()
              .replace(/\.?0+$/, '');
          }
          Display.updateMain();
        }
      },

      handleScientific(func) {
        const state = CalculatorState;
        const value = parseFloat(state.currentValue);
        const operation = Operations.scientific[func];
        
        if (operation) {
          const result = operation(value);
          if (result === null) {
            state.currentValue = 'Error';
          } else {
            state.currentValue = result.toString();
          }
          Display.updateMain();
        }
      },

      toggleSecond() {
        CalculatorState.secondMode = !CalculatorState.secondMode;
        Display.updateSecondMode();
        document.querySelector('.second').classList.toggle('active');
      },

      clearCalculator() {
        CalculatorState.reset();
        Display.updateMain();
        Display.updatePrevious();
      },

      backspace() {
        const state = CalculatorState;
        if (state.currentValue.length > 1) {
          state.currentValue = state.currentValue.slice(0, -1);
        } else {
          state.currentValue = '0';
        }
        Display.updateMain();
      }
    };

    // button-config.js
    const buttonConfig = [
      // Row 1
      { text: '2nd', class: 'second', handler: () => Handlers.toggleSecond() },
      { text: 'MR', class: 'memory', handler: () => Operations.memory.MR() },
      { text: 'MS', class: 'memory', handler: () => Operations.memory.MS() },
      { text: 'M+', class: 'memory', handler: () => Operations.memory.MC() },
      { text: 'C', class: 'clear', handler: () => Handlers.clearCalculator() },

      // Row 2
      { 
        text: 'x²', 
        secondaryText: 'x³', 
        class: 'function', 
        handler: () => Handlers.handleScientific(CalculatorState.secondMode ? 'cube' : 'square')
      },
      { 
        text: '√x', 
        secondaryText: '∛x', 
        class: 'function', 
        handler: () => Handlers.handleScientific(CalculatorState.secondMode ? 'cubeRoot' : 'sqrt')
      },
      { text: '1/x', class: 'function', handler: () => Handlers.handleScientific('inverse') },
      { text: '%', class: 'function', handler: () => Handlers.handleScientific('percent') },
      { text: '/', class: 'operator', handler: () => Handlers.handleOperator('/') },

      // Row 3
      { text: '7', handler: () => Handlers.handleNumber('7') },
      { text: '8', handler: () => Handlers.handleNumber('8') },
      { text: '9', handler: () => Handlers.handleNumber('9') },
      { text: '(', class: 'function', handler: () => Handlers.handleNumber('(') },
      { text: '×', class: 'operator', handler: () => Handlers.handleOperator('*') },

      // Row 4
      { text: '4', handler: () => Handlers.handleNumber('4') },
      { text: '5', handler: () => Handlers.handleNumber('5') },
      { text: '6', handler: () => Handlers.handleNumber('6') },
      { text: ')', class: 'function', handler: () => Handlers.handleNumber(')') },
      { text: '−', class: 'operator', handler: () => Handlers.handleOperator('-') },

      // Row 5
      { text: '1', handler: () => Handlers.handleNumber('1') },
      { text: '2', handler: () => Handlers.handleNumber('2') },
      { text: '3', handler: () => Handlers.handleNumber('3') },
      { text: '⌫', handler: () => Handlers.backspace() },
      { text: '+', class: 'operator', handler: () => Handlers.handleOperator('+') },

      // Row 6
      { text: '0', handler: () => Handlers.handleNumber('0') },
      { text: '.', handler: () => Handlers.handleNumber('.') },
      { text: 'xʸ', class: 'function', handler: () => Handlers.handleOperator('^') },
      { text: '=', class: 'equals', handler: () => Handlers.handleEquals() },
    ];

    // Initialize calculator
    function initializeCalculator() {
      const buttonsContainer = document.getElementById('calculator-buttons');
      
      buttonConfig.forEach(config => {
        const button = document.createElement('button');
        if (config.class) button.className = config.class;
        
        if (config.secondaryText) {
          button.innerHTML = `
            <span class="secondary-function">${config.secondaryText}</span>
            <span>${config.text}</span>
          `;
        } else {
          button.textContent = config.text;
        }
        
        button.addEventListener('click', config.handler);
        buttonsContainer.appendChild(button);
      });

      // Add keyboard support
      document.addEventListener('keydown', handleKeyPress);
    }

    function handleKeyPress(e) {
      const keyHandlers = {
        '0-9': key => Handlers.handleNumber(key),
        '.': () => Handlers.handleNumber('.'),
        '+': () => Handlers.handleOperator('+'),
        '-': () => Handlers.handleOperator('-'),
        '*': () => Handlers.handleOperator('*'),
        '/': () => Handlers.handleOperator('/'),
        'Enter': () => Handlers.handleEquals(),
        '=': () => Handlers.handleEquals(),
        'Backspace': () => Handlers.backspace(),
        'Escape': () => Handlers.clearCalculator(),
        '(': () => Handlers.handleNumber('('),
        ')': () => Handlers.handleNumber(')')
      };

      const key = e.key;
      if (/^[0-9]$/.test(key)) {
        keyHandlers['0-9'](key);
      } else if (keyHandlers[key]) {
        keyHandlers[key]();
      }
    }

    // Initialize the calculator when the page loads
    document.addEventListener('DOMContentLoaded', initializeCalculator);
  </script>
</body>
</html>
